<!DOCTYPE html>
<html>
    <head>
        <title>Secret Hitler</title>
        <link rel="icon" href="/img/favicon.png">
        <!--<link rel="stylesheet" href="/css/styles.min.css">-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"> 
        <!--<link rel="stylesheet" type="text/css" href="{{asset('../semantic/dist/semantic.min.css')}}">-->
        <!-- this is bad, but can't figure out why it's not working -->

        <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>-->
        <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
        <script src="../semantic/dist/semantic.min.js"></script>
    </head> 
    <body>
        <div class="ui active dimmer">
            <section class="ui segment">
                <div class="ui header">
                    Join a Room
                </div>
                <form class="ui form" action="">
                    <!--<label>Display Name</label>-->
                    <div class="field">
                        <div class="ui left icon input">
                            <i class="user icon"></i>
                            <input type="text" name="username" placeholder="Display Name" required
                                pattern="[A-Za-z0-9_]{1,15}" id="username-input">
                        </div>
                    </div>
                    <!--<label>Room</label>-->
                    <div class="field">
                        <div class="ui left icon input">
                            <input type="text" name="room" placeholder="Room" required id="room-input">
                            <i class="hand spock icon"></i>
                        </div>
                    </div>
                    <button class="ui positive button fluid large" id="join-button">Join</button>
                </form>
                <br>
                <button class="ui primary button fluid large" id="rules-button">Rules</button>
            </section>
            <div class="ui modal" id="modalrules">
                <div class="header">
                    TEST
                </div>
            </div>
        </div>
        <script>
            //$('#modalrules').modal('show');
            $(document).ready(function() {
                $('#rules-button').click(function() {
                    document.getElementById("modalrules").classList.add("active", "visible");
                    document.getElementById("modalrules").classList.remove("hidden");
                });
            });
        </script>
        <script>
            document.querySelector('form').addEventListener('submit', event => { event.preventDefault(); });
            document.querySelector('#join-button').addEventListener('click', () => {
                const room = document.getElementById('room-input').value;
                const username = document.getElementById('username-input').value;
                if (username.indexOf(' ') >= 0) {
                    console.log('username cannot contain whitespace');
                    return;
                }
                console.log('input room: ' + room);
                console.log('input username: ' + username);
                fetch('https://secret-hitler-project.herokuapp.com/checkLobbyAccess?room=' + room + '&username=' + username)
                .then(response => {
                    console.log(response);
                    return response.json();
                }).then(data => {
                    console.log(data);
                    if (data.valid) {
                        console.log('valid');
                        window.location.href = 'https://secret-hitler-project.herokuapp.com/lobby.html?username=' + username + '&room=' + room;
                    } else {
                        console.log(data.error);
                    }
                }).catch(error => {
                    console.log('something went wrong')
                    console.log(error);
                })
            });
        </script>
    </body>
</html>
